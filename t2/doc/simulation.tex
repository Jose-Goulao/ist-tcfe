%-------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------------------------------
\section{Simulation Analysis}
\label{sec:simulation}


In this section, Circuit T2 is reproduced with the help of Ngspice (each section corresponds
to each task). Ngspice is a simulator for eletronic circuits that can output a variety of results.
This emulator computes the voltages in every node, as well as the potential difference
between two given nodes. Apart from that, the group made use of the command
{\em .options savecurrents} which also enables the output of the currents that pass
through all branches.

With the limitation that Ngspice only provides the current in the components and not through
the nodes, an aditional voltage source ($Vaux$) was added so that the current in $R_6$ ($I_d$)
is known. This source (not displayed in Figure \ref{fig:Dsnh_sim_t2}) has a voltage of 0V and it 
was implemented between $R_6$ and $R_7$. Therefore an aditional node had to be added (node $N7.$).

As previously stated, $I_b$ is refered to as $G_1$. This is because, in Ngspice, a
voltage-controlled current source is identified with capital 'g' ($G$). In the case of
$V_c$, all current-controlled voltage source are identified with $H$.


%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
% 			      task1 - subsec
% ----------------------------------------------------------------------
% ----------------------------------------------------------------------
\subsection{Task 1)}
\label{subsec:task1_s}


In this subsection, the circuit is simulated when $t<0$. There is no need for a
transient analysis because $v_s(t)$=$V_s$ (according to the data given), therefore
all values are constant in time. 

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.75\linewidth]{dsnh_oct_t2_al1.pdf}
	\caption{Circuit T2, analysed by Ngspice}
\label{fig:Dsnh_sim_t2}
\end{figure}


Table \ref{tab:op1} shows the simulated operating point results for Circuit T2.

\begin{table}[H]
	\centering
	\begin{tabular}{|l|r|}
		\hline    
		{\bf Name} & {\bf Value [A or V]} \\ \hline
    		\input{op_tab}
	\end{tabular}
	
	\caption{Values from Ngspice. Variables identified with a '$@$' or are of the type
	$i(...)$ have a corresponding value in Ampere (A). The others are expressed in Volts (V).}
    
\label{tab:op1}
\end{table}

The three last entries in Table \ref{tab:op1} provides the potential diference between important
branches: $V_b$ = $v(n5,n2)$ and $V_d$ = $v(n5,n8)$.


%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
% 			      task2 - subsec
% ----------------------------------------------------------------------
% ----------------------------------------------------------------------
\subsection{Task 2)}
\label{subsec:task2_s}


In this subsection, the circuit is simulated when $t=0$. Since we can assume that enough time has passed for the circuit to reach steady-state, the capacitor is charge and so, at the instant $t=0$ it can replaced with a voltage source, 
with its value being equal to de diference between the voltages in nodes $n6$ and $n8$ (or $V_x$ = $V(n6)-
V(n8)$) obtained in subsection \ref{subsec:task1_s}. Vs is also set to 0.

This step is necessary to find the boundary conditions of the circuit at $t=0$, which will be used in the next section to calculate the natural response of the T2 circuit.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.75\linewidth]{dsnh_oct_t2_al2.pdf}
	\caption{Circuit T2, analysed by Ngspice}
\label{fig:Dsnh_sim_t2}
\end{figure}

Table \ref{tab:op2} shows the simulated operating point results for Circuit T2.

\begin{table}[H]
	\centering
	\begin{tabular}{|l|r|}
		\hline    
		{\bf Name} & {\bf Value [A or V]} \\ \hline
    		\input{_tab}
	\end{tabular}
	
	\caption{Values from Ngspice. Variables identified with a '$@$' or are of the type
	$i(...)$ have a corresponding value in Ampere (A). The others are expressed in Volts (V).}
    
\label{tab:op2}
\end{table}


%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
% 			      task3 - subsec
% ----------------------------------------------------------------------
% ----------------------------------------------------------------------
\subsection{Task 3)}
\label{subsec:task3_s}

In this subsection, the natural response of the circuit was simulated using the boundary conditions
$V(n6)$ and $V(n8)$ calculated in subsection \ref{subsec:task2_s}. Thus, $V_{n6}(t)$ was ploted in the 
interval [0;20]$ms$ (Figure \ref{fig:trans-1}).

\begin{figure}[H]
	\centering
	\includegraphics[width=0.75\linewidth]{dsnh_oct_t2_al3.pdf}
	\caption{Circuit T2, analysed by Ngspice}
\label{fig:Dsnh_sim_t2}
\end{figure}


\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\linewidth]{trans-1.eps}
	\caption{Transient analysis - 1: natural response on node $n6$}
\label{fig:trans-1}
\end{figure}




%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
% 			      task4 - subsec
% ----------------------------------------------------------------------
% ----------------------------------------------------------------------
\subsection{Task 4)}
\label{subsec:task4_s}

In this subsection, the total (natural and forced) responde on node $n6$ is simulated. The boundary
conditions used are the same as subsection \ref{subsec:task3_s} and a frequency of 1kHz (f=1KHz) is
considered for $v_s(t)$. Figure \ref{fig:trans-2} shows the plot. It is worth noting that node $n1$ has
the same value as the stimulus ($v_s(t)$), so $V(n1)$ is used instead.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.75\linewidth]{dsnh_oct_t2_al456.pdf}
	\caption{Circuit T2, analysed by Ngspice}
\label{circ_ori}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.55\linewidth]{trans-2.eps}
	\caption{Transient analysis - 2: total response on node $n6$}
\label{fig:trans-2}
\end{figure}


%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
% 			      task5 - subsec
% ----------------------------------------------------------------------
% ----------------------------------------------------------------------
\subsection{Task 5)}
\label{subsec:task5_s}

In this subsection, the frequency response on $V_s$ and on node $n6$ is computed (using the circuit diagram \ref{circ_ori} and shown in the following plots.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.55\linewidth]{ac-1.eps}
	\caption{Frequency response - 1}
\label{fig:Dsnh_sim_t2}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.55\linewidth]{ac-2.eps}
	\caption{Frequency response - 2}
\label{fig:Dsnh_sim_t2}
\end{figure}

Since the frequency response is made by changing $V_s$ itself, the values of magnitude and phase of $V_s$ aren't dependent on frequency. For this reason the plot lines of these values are constant.

By contrast the magnitude and phase of $V_6$ change with frequency. At low frequencys $V_6$ is in phase with $V_s$ but as the frequency increases, the phase shift also increases until it reaches a phase difference of 180ยบ, meaning it's totally out of pahse with the source. The magnitude starts at a value of around 1.065dB than $V_s$ and with increasing value it decreases until it hits a plateau at around -5.275dB. 

These values are in accordance with the node voltage values one would get if the capacitor was removed or shorted, respectively. This is due to the fact that the impedance value of a capacitor follows the equation $frac{1}{C\omega}$. At low frequencies the impedance is very large and so it's almost like the connection between $N6$ and $N8$ didn't exist. In contrast, at high frequencies the impedance is almost null so the circuit behaves almost as $N6$ and $N8$ were shorted.






